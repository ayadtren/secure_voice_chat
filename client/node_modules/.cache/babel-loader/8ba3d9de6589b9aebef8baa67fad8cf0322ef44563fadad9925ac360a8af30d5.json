{"ast":null,"code":"var _jsxFileName = \"/Users/ayadyousifshahi/Documents/webchat app/client/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { io } from 'socket.io-client';\nimport './App.css';\nimport UserList from './components/UserList';\nimport AudioControls from './components/AudioControls';\nimport ConnectionStatus from './components/ConnectionStatus';\nimport Login from './components/Login';\nimport { WebRTCManager } from './utils/webrtcManager';\nimport QRCodeGenerator from './components/QRCodeGenerator';\nimport QRCodeScanner from './components/QRCodeScanner';\nimport { Button } from './components/ui/button';\n\n// Configuration\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SERVER_URL = process.env.REACT_APP_SERVER_URL || window.location.origin;\nfunction App() {\n  _s();\n  // State\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [username, setUsername] = useState('');\n  const [users, setUsers] = useState([]);\n  const [currentCall, setCurrentCall] = useState(null);\n  const [callStatus, setCallStatus] = useState('idle'); // idle, calling, connected\n  const [audioEnabled, setAudioEnabled] = useState(true);\n  const [networkQuality, setNetworkQuality] = useState(100); // 0-100\n  const [darkMode, setDarkMode] = useState(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [showQRScanner, setShowQRScanner] = useState(false);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [peerSpeaking, setPeerSpeaking] = useState(false);\n  const [webrtcManager, setWebrtcManager] = useState(null);\n\n  // Refs\n  const localStream = useRef(null);\n  const localAudioRef = useRef(null);\n  const remoteAudioRef = useRef(null);\n\n  // Initialize socket connection\n  useEffect(() => {\n    const newSocket = io(SERVER_URL, {\n      reconnectionAttempts: 10,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      timeout: 20000\n    });\n    setSocket(newSocket);\n\n    // Socket event listeners\n    newSocket.on('connect', () => {\n      console.log('Connected to server');\n      setConnected(true);\n    });\n    newSocket.on('disconnect', () => {\n      console.log('Disconnected from server');\n      setConnected(false);\n      handleCallEnd();\n    });\n    newSocket.on('error', error => {\n      console.error('Socket error:', error);\n      alert(`Error: ${error.message}`);\n    });\n    newSocket.on('userList', userList => {\n      setUsers(userList.filter(user => user.id !== newSocket.id));\n    });\n    newSocket.on('registered', data => {\n      console.log('Registered as:', data.username);\n      setUsername(data.username);\n    });\n\n    // WebRTC signaling events\n    newSocket.on('offer', async ({\n      from,\n      offer\n    }) => {\n      console.log('Received offer from:', from);\n\n      // If already in a call, reject\n      if (callStatus !== 'idle') {\n        newSocket.emit('busy', {\n          target: from\n        });\n        return;\n      }\n\n      // Get caller info\n      const caller = users.find(user => user.id === from);\n      if (!caller) return;\n\n      // Ask user to accept call\n      const accept = window.confirm(`Incoming call from ${caller.username}. Accept?`);\n      if (!accept) {\n        newSocket.emit('reject', {\n          target: from\n        });\n        return;\n      }\n      try {\n        // Setup WebRTC connection using enhanced manager\n        const manager = new WebRTCManager(newSocket, {\n          userId: newSocket.id,\n          onPeerConnect: (peerId, stream) => {\n            if (remoteAudioRef.current && stream) {\n              remoteAudioRef.current.srcObject = stream;\n            }\n            setCallStatus('connected');\n          },\n          onPeerDisconnect: () => {\n            handleCallEnd();\n          },\n          onSpeakingChange: speaking => {\n            setIsSpeaking(speaking);\n          },\n          onAudioQualityChange: (peerId, quality) => {\n            setNetworkQuality(Math.round(quality));\n          },\n          onError: error => {\n            console.error('WebRTC error:', error);\n            alert(`WebRTC error: ${error}`);\n          }\n        });\n        setWebrtcManager(manager);\n\n        // Initialize and accept the call\n        await manager.initialize(from);\n        await manager.acceptIncomingCall(from, offer);\n        setCurrentCall(caller);\n        setCallStatus('connected');\n      } catch (error) {\n        console.error('Error accepting call:', error);\n        alert('Failed to accept call. Please try again.');\n      }\n    });\n    newSocket.on('answer', async ({\n      from,\n      answer\n    }) => {\n      console.log('Received answer from:', from);\n      if (!webrtcManager || callStatus !== 'calling') return;\n      try {\n        await webrtcManager.handleAnswer(from, answer);\n        console.log('Remote description set successfully');\n        setCallStatus('connected');\n      } catch (error) {\n        console.error('Error setting remote description:', error);\n        handleCallEnd();\n      }\n    });\n    newSocket.on('iceCandidate', async ({\n      from,\n      candidate\n    }) => {\n      console.log('Received ICE candidate from:', from);\n      if (!webrtcManager) return;\n      try {\n        await webrtcManager.addIceCandidate(from, candidate);\n        console.log('Added ICE candidate successfully');\n      } catch (error) {\n        console.error('Error adding ICE candidate:', error);\n      }\n    });\n    newSocket.on('speaking', ({\n      userId,\n      speaking\n    }) => {\n      if (currentCall && userId === currentCall.id) {\n        setPeerSpeaking(speaking);\n      }\n    });\n    newSocket.on('reject', () => {\n      alert('Call was rejected');\n      handleCallEnd();\n    });\n    newSocket.on('busy', () => {\n      alert('User is busy');\n      handleCallEnd();\n    });\n    newSocket.on('callEnded', () => {\n      alert('Call ended by the other user');\n      handleCallEnd();\n    });\n\n    // Cleanup on unmount\n    return () => {\n      if (newSocket) {\n        newSocket.disconnect();\n      }\n      cleanupLocalStream();\n      if (webrtcManager) {\n        webrtcManager.dispose();\n      }\n    };\n  }, [callStatus, currentCall, handleCallEnd, users, webrtcManager]);\n\n  // Handle dark mode preference changes\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = e => setDarkMode(e.matches);\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n\n  // Apply dark mode class to body\n  useEffect(() => {\n    if (darkMode) {\n      document.body.classList.add('dark-mode');\n    } else {\n      document.body.classList.remove('dark-mode');\n    }\n  }, [darkMode]);\n\n  // Setup local audio stream\n  const setupLocalStream = async () => {\n    try {\n      if (webrtcManager) {\n        const stream = await webrtcManager.getLocalStream();\n        localStream.current = stream;\n        if (localAudioRef.current) {\n          localAudioRef.current.srcObject = stream;\n        }\n        return stream;\n      } else {\n        // Fallback to basic audio setup\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            autoGainControl: true\n          },\n          video: false\n        });\n        localStream.current = stream;\n        if (localAudioRef.current) {\n          localAudioRef.current.srcObject = stream;\n        }\n        return stream;\n      }\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n      alert('Failed to access microphone. Please check permissions and try again.');\n      throw error;\n    }\n  };\n\n  // Cleanup local stream\n  const cleanupLocalStream = () => {\n    if (localStream.current) {\n      localStream.current.getTracks().forEach(track => track.stop());\n      localStream.current = null;\n    }\n  };\n\n  // Handle user registration\n  const handleLogin = async username => {\n    if (!socket || !connected) {\n      alert('Not connected to server');\n      return;\n    }\n    socket.emit('register', {\n      username\n    });\n  };\n\n  // Start a call with a user\n  const startCall = async targetUser => {\n    if (callStatus !== 'idle') return;\n    try {\n      // Create new WebRTC manager\n      const manager = new WebRTCManager(socket, {\n        userId: socket.id,\n        onPeerConnect: (peerId, stream) => {\n          if (remoteAudioRef.current && stream) {\n            remoteAudioRef.current.srcObject = stream;\n          }\n          setCallStatus('connected');\n        },\n        onPeerDisconnect: () => {\n          handleCallEnd();\n        },\n        onSpeakingChange: speaking => {\n          setIsSpeaking(speaking);\n        },\n        onAudioQualityChange: (peerId, quality) => {\n          setNetworkQuality(Math.round(quality));\n        },\n        onError: error => {\n          console.error('WebRTC error:', error);\n          alert(`WebRTC error: ${error}`);\n        }\n      });\n      setWebrtcManager(manager);\n\n      // Initialize and start the call\n      await manager.initialize(targetUser.id);\n      await manager.startCall(targetUser.id);\n      setCurrentCall(targetUser);\n      setCallStatus('calling');\n    } catch (error) {\n      console.error('Error starting call:', error);\n      alert('Failed to start call. Please try again.');\n      handleCallEnd();\n    }\n  };\n\n  // End the current call\n  const endCall = () => {\n    if (!socket || !currentCall) return;\n    socket.emit('callEnded', {\n      target: currentCall.id\n    });\n    handleCallEnd();\n  };\n\n  // Handle call end (cleanup)\n  const handleCallEnd = useCallback(() => {\n    if (webrtcManager) {\n      webrtcManager.dispose();\n      setWebrtcManager(null);\n    }\n    cleanupLocalStream();\n    setCurrentCall(null);\n    setCallStatus('idle');\n    setNetworkQuality(100);\n    setIsSpeaking(false);\n    setPeerSpeaking(false);\n  }, [webrtcManager]);\n\n  // Toggle microphone\n  const toggleMicrophone = () => {\n    if (webrtcManager) {\n      const enabled = webrtcManager.toggleMicrophone();\n      setAudioEnabled(enabled);\n    } else if (localStream.current) {\n      const audioTrack = localStream.current.getAudioTracks()[0];\n      if (audioTrack) {\n        audioTrack.enabled = !audioTrack.enabled;\n        setAudioEnabled(audioTrack.enabled);\n      }\n    }\n  };\n\n  // Toggle dark mode\n  const toggleDarkMode = () => {\n    setDarkMode(!darkMode);\n  };\n\n  // Handle QR code scan result\n  const handleQRScan = data => {\n    try {\n      const connectionData = JSON.parse(data);\n      if (connectionData.roomId && connectionData.userId) {\n        // Start call with scanned user\n        const user = {\n          id: connectionData.userId,\n          username: connectionData.username || 'User via QR'\n        };\n        startCall(user);\n        setShowQRScanner(false);\n      }\n    } catch (error) {\n      console.error('Invalid QR code data:', error);\n      alert('Invalid QR code. Please try again.');\n    }\n  };\n\n  // Generate QR code data\n  const getQRCodeData = () => {\n    return JSON.stringify({\n      roomId: socket === null || socket === void 0 ? void 0 : socket.id,\n      userId: socket === null || socket === void 0 ? void 0 : socket.id,\n      username: username\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `app ${darkMode ? 'dark-mode' : 'light-mode'}`,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"app-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Secure Voice Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"theme-toggle\",\n        onClick: toggleDarkMode,\n        \"aria-label\": darkMode ? 'Switch to light mode' : 'Switch to dark mode',\n        children: darkMode ? '☀️' : '🌙'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"app-content\",\n      children: !username ? /*#__PURE__*/_jsxDEV(Login, {\n        onLogin: handleLogin,\n        connected: connected\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(ConnectionStatus, {\n          connected: connected,\n          callStatus: callStatus,\n          currentCall: currentCall,\n          networkQuality: networkQuality,\n          isSpeaking: isSpeaking,\n          peerSpeaking: peerSpeaking\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 13\n        }, this), callStatus === 'idle' ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"connection-options\",\n          children: [/*#__PURE__*/_jsxDEV(UserList, {\n            users: users,\n            onCallUser: startCall\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"qr-options\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              onClick: () => setShowQRCode(!showQRCode),\n              variant: \"outline\",\n              children: showQRCode ? 'Hide QR Code' : 'Show QR Code'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 424,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              onClick: () => setShowQRScanner(!showQRScanner),\n              variant: \"outline\",\n              children: showQRScanner ? 'Hide QR Scanner' : 'Scan QR Code'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 431,\n              columnNumber: 19\n            }, this), showQRCode && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"qr-container\",\n              children: /*#__PURE__*/_jsxDEV(QRCodeGenerator, {\n                data: getQRCodeData(),\n                size: 200,\n                title: \"Scan to connect with me\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 440,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 439,\n              columnNumber: 21\n            }, this), showQRScanner && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"qr-container\",\n              children: /*#__PURE__*/_jsxDEV(QRCodeScanner, {\n                onScan: handleQRScan,\n                onError: error => console.error('QR scan error:', error),\n                onClose: () => setShowQRScanner(false)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 450,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"call-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: callStatus === 'calling' ? `Calling ${currentCall === null || currentCall === void 0 ? void 0 : currentCall.username}...` : `In call with ${currentCall === null || currentCall === void 0 ? void 0 : currentCall.username}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 461,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"speaking-indicators\",\n            children: [isSpeaking && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"speaking-indicator you\",\n              children: \"You are speaking\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 468,\n              columnNumber: 34\n            }, this), peerSpeaking && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"speaking-indicator peer\",\n              children: [currentCall === null || currentCall === void 0 ? void 0 : currentCall.username, \" is speaking\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 469,\n              columnNumber: 36\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 467,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(AudioControls, {\n            audioEnabled: audioEnabled,\n            onToggleMicrophone: toggleMicrophone,\n            onEndCall: endCall\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 460,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n      className: \"app-footer\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"End-to-end encrypted \\u2022 Zero persistence \\u2022 Local network only\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 483,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: localAudioRef,\n      muted: true,\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 488,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: remoteAudioRef,\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 489,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 390,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"RBk4AGIaNT8IeM6mpKOfC1b0ET4=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","io","UserList","AudioControls","ConnectionStatus","Login","WebRTCManager","QRCodeGenerator","QRCodeScanner","Button","jsxDEV","_jsxDEV","Fragment","_Fragment","SERVER_URL","process","env","REACT_APP_SERVER_URL","window","location","origin","App","_s","socket","setSocket","connected","setConnected","username","setUsername","users","setUsers","currentCall","setCurrentCall","callStatus","setCallStatus","audioEnabled","setAudioEnabled","networkQuality","setNetworkQuality","darkMode","setDarkMode","matchMedia","matches","showQRCode","setShowQRCode","showQRScanner","setShowQRScanner","isSpeaking","setIsSpeaking","peerSpeaking","setPeerSpeaking","webrtcManager","setWebrtcManager","localStream","localAudioRef","remoteAudioRef","newSocket","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","timeout","on","console","log","handleCallEnd","error","alert","message","userList","filter","user","id","data","from","offer","emit","target","caller","find","accept","confirm","manager","userId","onPeerConnect","peerId","stream","current","srcObject","onPeerDisconnect","onSpeakingChange","speaking","onAudioQualityChange","quality","Math","round","onError","initialize","acceptIncomingCall","answer","handleAnswer","candidate","addIceCandidate","disconnect","cleanupLocalStream","dispose","mediaQuery","handleChange","e","addEventListener","removeEventListener","document","body","classList","add","remove","setupLocalStream","getLocalStream","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","autoGainControl","video","getTracks","forEach","track","stop","handleLogin","startCall","targetUser","endCall","toggleMicrophone","enabled","audioTrack","getAudioTracks","toggleDarkMode","handleQRScan","connectionData","JSON","parse","roomId","getQRCodeData","stringify","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","onLogin","onCallUser","variant","size","title","onScan","onClose","onToggleMicrophone","onEndCall","ref","muted","autoPlay","playsInline","_c","$RefreshReg$"],"sources":["/Users/ayadyousifshahi/Documents/webchat app/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { io } from 'socket.io-client';\nimport './App.css';\nimport UserList from './components/UserList';\nimport AudioControls from './components/AudioControls';\nimport ConnectionStatus from './components/ConnectionStatus';\nimport Login from './components/Login';\nimport { WebRTCManager } from './utils/webrtcManager';\nimport QRCodeGenerator from './components/QRCodeGenerator';\nimport QRCodeScanner from './components/QRCodeScanner';\nimport { Button } from './components/ui/button';\n\n// Configuration\nconst SERVER_URL = process.env.REACT_APP_SERVER_URL || window.location.origin;\n\nfunction App() {\n  // State\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [username, setUsername] = useState('');\n  const [users, setUsers] = useState([]);\n  const [currentCall, setCurrentCall] = useState(null);\n  const [callStatus, setCallStatus] = useState('idle'); // idle, calling, connected\n  const [audioEnabled, setAudioEnabled] = useState(true);\n  const [networkQuality, setNetworkQuality] = useState(100); // 0-100\n  const [darkMode, setDarkMode] = useState(\n    window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n  );\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [showQRScanner, setShowQRScanner] = useState(false);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [peerSpeaking, setPeerSpeaking] = useState(false);\n  const [webrtcManager, setWebrtcManager] = useState(null);\n  \n  // Refs\n  const localStream = useRef(null);\n  const localAudioRef = useRef(null);\n  const remoteAudioRef = useRef(null);\n  \n  // Initialize socket connection\n  useEffect(() => {\n    const newSocket = io(SERVER_URL, {\n      reconnectionAttempts: 10,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      timeout: 20000,\n    });\n    \n    setSocket(newSocket);\n    \n    // Socket event listeners\n    newSocket.on('connect', () => {\n      console.log('Connected to server');\n      setConnected(true);\n    });\n    \n    newSocket.on('disconnect', () => {\n      console.log('Disconnected from server');\n      setConnected(false);\n      handleCallEnd();\n    });\n    \n    newSocket.on('error', (error) => {\n      console.error('Socket error:', error);\n      alert(`Error: ${error.message}`);\n    });\n    \n    newSocket.on('userList', (userList) => {\n      setUsers(userList.filter(user => user.id !== newSocket.id));\n    });\n    \n    newSocket.on('registered', (data) => {\n      console.log('Registered as:', data.username);\n      setUsername(data.username);\n    });\n    \n    // WebRTC signaling events\n    newSocket.on('offer', async ({ from, offer }) => {\n      console.log('Received offer from:', from);\n      \n      // If already in a call, reject\n      if (callStatus !== 'idle') {\n        newSocket.emit('busy', { target: from });\n        return;\n      }\n      \n      // Get caller info\n      const caller = users.find(user => user.id === from);\n      if (!caller) return;\n      \n      // Ask user to accept call\n      const accept = window.confirm(`Incoming call from ${caller.username}. Accept?`);\n      if (!accept) {\n        newSocket.emit('reject', { target: from });\n        return;\n      }\n      \n      try {\n        // Setup WebRTC connection using enhanced manager\n        const manager = new WebRTCManager(newSocket, {\n          userId: newSocket.id,\n          onPeerConnect: (peerId, stream) => {\n            if (remoteAudioRef.current && stream) {\n              remoteAudioRef.current.srcObject = stream;\n            }\n            setCallStatus('connected');\n          },\n          onPeerDisconnect: () => {\n            handleCallEnd();\n          },\n          onSpeakingChange: (speaking) => {\n            setIsSpeaking(speaking);\n          },\n          onAudioQualityChange: (peerId, quality) => {\n            setNetworkQuality(Math.round(quality));\n          },\n          onError: (error) => {\n            console.error('WebRTC error:', error);\n            alert(`WebRTC error: ${error}`);\n          }\n        });\n        \n        setWebrtcManager(manager);\n        \n        // Initialize and accept the call\n        await manager.initialize(from);\n        await manager.acceptIncomingCall(from, offer);\n        \n        setCurrentCall(caller);\n        setCallStatus('connected');\n        \n      } catch (error) {\n        console.error('Error accepting call:', error);\n        alert('Failed to accept call. Please try again.');\n      }\n    });\n    \n    newSocket.on('answer', async ({ from, answer }) => {\n      console.log('Received answer from:', from);\n      \n      if (!webrtcManager || callStatus !== 'calling') return;\n      \n      try {\n        await webrtcManager.handleAnswer(from, answer);\n        console.log('Remote description set successfully');\n        setCallStatus('connected');\n      } catch (error) {\n        console.error('Error setting remote description:', error);\n        handleCallEnd();\n      }\n    });\n    \n    newSocket.on('iceCandidate', async ({ from, candidate }) => {\n      console.log('Received ICE candidate from:', from);\n      \n      if (!webrtcManager) return;\n      \n      try {\n        await webrtcManager.addIceCandidate(from, candidate);\n        console.log('Added ICE candidate successfully');\n      } catch (error) {\n        console.error('Error adding ICE candidate:', error);\n      }\n    });\n    \n    newSocket.on('speaking', ({ userId, speaking }) => {\n      if (currentCall && userId === currentCall.id) {\n        setPeerSpeaking(speaking);\n      }\n    });\n    \n    newSocket.on('reject', () => {\n      alert('Call was rejected');\n      handleCallEnd();\n    });\n    \n    newSocket.on('busy', () => {\n      alert('User is busy');\n      handleCallEnd();\n    });\n    \n    newSocket.on('callEnded', () => {\n      alert('Call ended by the other user');\n      handleCallEnd();\n    });\n    \n    // Cleanup on unmount\n    return () => {\n      if (newSocket) {\n        newSocket.disconnect();\n      }\n      cleanupLocalStream();\n      if (webrtcManager) {\n        webrtcManager.dispose();\n      }\n    };\n  }, [callStatus, currentCall, handleCallEnd, users, webrtcManager]);\n  \n  // Handle dark mode preference changes\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = (e) => setDarkMode(e.matches);\n    \n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n  \n  // Apply dark mode class to body\n  useEffect(() => {\n    if (darkMode) {\n      document.body.classList.add('dark-mode');\n    } else {\n      document.body.classList.remove('dark-mode');\n    }\n  }, [darkMode]);\n  \n  // Setup local audio stream\n  const setupLocalStream = async () => {\n    try {\n      if (webrtcManager) {\n        const stream = await webrtcManager.getLocalStream();\n        localStream.current = stream;\n        \n        if (localAudioRef.current) {\n          localAudioRef.current.srcObject = stream;\n        }\n        \n        return stream;\n      } else {\n        // Fallback to basic audio setup\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            autoGainControl: true\n          },\n          video: false\n        });\n        \n        localStream.current = stream;\n        \n        if (localAudioRef.current) {\n          localAudioRef.current.srcObject = stream;\n        }\n        \n        return stream;\n      }\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n      alert('Failed to access microphone. Please check permissions and try again.');\n      throw error;\n    }\n  };\n  \n  // Cleanup local stream\n  const cleanupLocalStream = () => {\n    if (localStream.current) {\n      localStream.current.getTracks().forEach(track => track.stop());\n      localStream.current = null;\n    }\n  };\n  \n  // Handle user registration\n  const handleLogin = async (username) => {\n    if (!socket || !connected) {\n      alert('Not connected to server');\n      return;\n    }\n    \n    socket.emit('register', { username });\n  };\n  \n  // Start a call with a user\n  const startCall = async (targetUser) => {\n    if (callStatus !== 'idle') return;\n    \n    try {\n      // Create new WebRTC manager\n      const manager = new WebRTCManager(socket, {\n        userId: socket.id,\n        onPeerConnect: (peerId, stream) => {\n          if (remoteAudioRef.current && stream) {\n            remoteAudioRef.current.srcObject = stream;\n          }\n          setCallStatus('connected');\n        },\n        onPeerDisconnect: () => {\n          handleCallEnd();\n        },\n        onSpeakingChange: (speaking) => {\n          setIsSpeaking(speaking);\n        },\n        onAudioQualityChange: (peerId, quality) => {\n          setNetworkQuality(Math.round(quality));\n        },\n        onError: (error) => {\n          console.error('WebRTC error:', error);\n          alert(`WebRTC error: ${error}`);\n        }\n      });\n      \n      setWebrtcManager(manager);\n      \n      // Initialize and start the call\n      await manager.initialize(targetUser.id);\n      await manager.startCall(targetUser.id);\n      \n      setCurrentCall(targetUser);\n      setCallStatus('calling');\n      \n    } catch (error) {\n      console.error('Error starting call:', error);\n      alert('Failed to start call. Please try again.');\n      handleCallEnd();\n    }\n  };\n  \n  // End the current call\n  const endCall = () => {\n    if (!socket || !currentCall) return;\n    \n    socket.emit('callEnded', { target: currentCall.id });\n    handleCallEnd();\n  };\n  \n  // Handle call end (cleanup)\n  const handleCallEnd = useCallback(() => {\n    if (webrtcManager) {\n      webrtcManager.dispose();\n      setWebrtcManager(null);\n    }\n    \n    cleanupLocalStream();\n    \n    setCurrentCall(null);\n    setCallStatus('idle');\n    setNetworkQuality(100);\n    setIsSpeaking(false);\n    setPeerSpeaking(false);\n  }, [webrtcManager]);\n  \n  // Toggle microphone\n  const toggleMicrophone = () => {\n    if (webrtcManager) {\n      const enabled = webrtcManager.toggleMicrophone();\n      setAudioEnabled(enabled);\n    } else if (localStream.current) {\n      const audioTrack = localStream.current.getAudioTracks()[0];\n      if (audioTrack) {\n        audioTrack.enabled = !audioTrack.enabled;\n        setAudioEnabled(audioTrack.enabled);\n      }\n    }\n  };\n  \n  // Toggle dark mode\n  const toggleDarkMode = () => {\n    setDarkMode(!darkMode);\n  };\n  \n  // Handle QR code scan result\n  const handleQRScan = (data) => {\n    try {\n      const connectionData = JSON.parse(data);\n      if (connectionData.roomId && connectionData.userId) {\n        // Start call with scanned user\n        const user = {\n          id: connectionData.userId,\n          username: connectionData.username || 'User via QR'\n        };\n        startCall(user);\n        setShowQRScanner(false);\n      }\n    } catch (error) {\n      console.error('Invalid QR code data:', error);\n      alert('Invalid QR code. Please try again.');\n    }\n  };\n  \n  // Generate QR code data\n  const getQRCodeData = () => {\n    return JSON.stringify({\n      roomId: socket?.id,\n      userId: socket?.id,\n      username: username\n    });\n  };\n  \n  return (\n    <div className={`app ${darkMode ? 'dark-mode' : 'light-mode'}`}>\n      <header className=\"app-header\">\n        <h1>Secure Voice Chat</h1>\n        <button \n          className=\"theme-toggle\" \n          onClick={toggleDarkMode} \n          aria-label={darkMode ? 'Switch to light mode' : 'Switch to dark mode'}\n        >\n          {darkMode ? '☀️' : '🌙'}\n        </button>\n      </header>\n      \n      <main className=\"app-content\">\n        {!username ? (\n          <Login onLogin={handleLogin} connected={connected} />\n        ) : (\n          <>\n            <ConnectionStatus \n              connected={connected} \n              callStatus={callStatus} \n              currentCall={currentCall}\n              networkQuality={networkQuality}\n              isSpeaking={isSpeaking}\n              peerSpeaking={peerSpeaking}\n            />\n            \n            {callStatus === 'idle' ? (\n              <div className=\"connection-options\">\n                <UserList \n                  users={users} \n                  onCallUser={startCall} \n                />\n                \n                <div className=\"qr-options\">\n                  <Button \n                    onClick={() => setShowQRCode(!showQRCode)}\n                    variant=\"outline\"\n                  >\n                    {showQRCode ? 'Hide QR Code' : 'Show QR Code'}\n                  </Button>\n                  \n                  <Button \n                    onClick={() => setShowQRScanner(!showQRScanner)}\n                    variant=\"outline\"\n                  >\n                    {showQRScanner ? 'Hide QR Scanner' : 'Scan QR Code'}\n                  </Button>\n                  \n                  {showQRCode && (\n                    <div className=\"qr-container\">\n                      <QRCodeGenerator \n                        data={getQRCodeData()} \n                        size={200}\n                        title=\"Scan to connect with me\"\n                      />\n                    </div>\n                  )}\n                  \n                  {showQRScanner && (\n                    <div className=\"qr-container\">\n                      <QRCodeScanner \n                        onScan={handleQRScan}\n                        onError={(error) => console.error('QR scan error:', error)}\n                        onClose={() => setShowQRScanner(false)}\n                      />\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"call-container\">\n                <h2>\n                  {callStatus === 'calling' \n                    ? `Calling ${currentCall?.username}...` \n                    : `In call with ${currentCall?.username}`}\n                </h2>\n                \n                <div className=\"speaking-indicators\">\n                  {isSpeaking && <div className=\"speaking-indicator you\">You are speaking</div>}\n                  {peerSpeaking && <div className=\"speaking-indicator peer\">{currentCall?.username} is speaking</div>}\n                </div>\n                \n                <AudioControls \n                  audioEnabled={audioEnabled} \n                  onToggleMicrophone={toggleMicrophone} \n                  onEndCall={endCall} \n                />\n              </div>\n            )}\n          </>\n        )}\n      </main>\n      \n      <footer className=\"app-footer\">\n        <p>End-to-end encrypted • Zero persistence • Local network only</p>\n      </footer>\n      \n      {/* Hidden audio elements */}\n      <audio ref={localAudioRef} muted autoPlay playsInline />\n      <audio ref={remoteAudioRef} autoPlay playsInline />\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}